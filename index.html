<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JET GO ALERT</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Firebase -->
    <script type="module" src="js/firebase.js"></script>
    <!-- Firebase App (Core SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-messaging.js"></script>
<script>
  const firebaseConfig = {
     apiKey: "AIzaSyB_0CodzHFyERYxy2Apy8Zp4QbHsbr4rfk",
    authDomain: "jet-go-alert.firebaseapp.com",
    projectId: "jet-go-alert",
    storageBucket: "jet-go-alert.firebasestorage.app",
    messagingSenderId: "605131486515",
    appId: "1:605131486515:web:ae9661d467e1f63725ba46",
    measurementId: "G-LF30TWJ3YS"
  };
  firebase.initializeApp(firebaseConfig);
    
// Retrieve an instance of Firebase Messaging so that it can handle background messages
const messaging = firebase.messaging();

// Handle background messages
messaging.onBackgroundMessage((payload) => {
  console.log('[firebase-messaging-sw.js] Received background message ', payload);
  const notificationTitle = payload.notification.title;
  const notificationOptions = {
    body: payload.notification.body,
    icon: '/firebase-logo.png'
  };

  self.registration.showNotification(notificationTitle, notificationOptions);
});
</script>


    <!-- Google Maps API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_NEW_API_KEY&callback=initMap"></script>

    <!-- Leaflet JS for OpenStreetMap -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script defer src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <style>
        #map { height: 400px; width: 100%; }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <h1>JET GO ALERT</h1>
        <button id="darkModeToggle" aria-label="Toggle Dark Mode">Toggle Dark Mode</button>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Earthquake Alerts Section -->
        <section id="alerts">
            <h2>Earthquake Alerts</h2>
            <div id="alert-container">Loading earthquake data...</div>
        </section>

        <!-- Earthquake Map Section -->
        <section id="quake-map">
            <h2>Earthquake Map</h2>
            <div id="map"></div>
        </section>

        <!-- User Reports Section -->
        <section id="reports">
            <h2>User Reports</h2>
            <textarea id="user-report" placeholder="Describe your experience..." aria-label="Describe your experience"></textarea>
            <button id="report-submit" aria-label="Submit report">Submit</button>
            <div id="report-list"></div>
        </section>
        
        <section id="user-location">
    <h2>Your Location & Safety Tips</h2>
    <button id="getLocation">Find My Location</button>
    <p id="location-output">Click the button to get your location.</p>
    <div id="safety-tips"></div>
</section>

    </main>

    <!-- Footer -->
    <footer>
        <p>JET GO ALERT &copy; 2025</p>
    </footer>

    <!-- JavaScript Files -->
    <script defer src="js/main.js"></script>
    <script defer src="js/earthquake.js"></script>
    <script defer src="js/reports.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Initialize Map
            var map = L.map('map').setView([14.5995, 120.9842], 6);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            // Fetch Earthquake Data
            async function fetchEarthquakeData() {
                try {
                    const response = await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_day.geojson');
                    if (!response.ok) throw new Error('Network response was not ok');

                    const data = await response.json();
                    const earthquakes = data.features.filter(eq => eq.properties.place.includes('Philippines'));

                    let alertContainer = document.getElementById("alert-container");
                    alertContainer.innerHTML = earthquakes.length ? "" : "No recent earthquakes detected.";

                    earthquakes.forEach(eq => {
                        const { mag, place, time } = eq.properties;
                        const date = new Date(time).toLocaleString();

                        alertContainer.innerHTML += `<p><strong>${date}</strong>: M${mag} - ${place}</p>`;

                        L.marker([eq.geometry.coordinates[1], eq.geometry.coordinates[0]])
                            .addTo(map)
                            .bindPopup(`<b>${place}</b><br>Magnitude: ${mag}<br>${date}`);
                    });

                } catch (error) {
                    console.error("Error fetching earthquake data:", error);
                    document.getElementById("alert-container").innerHTML = "Error loading data.";
                }
            }

            fetchEarthquakeData(); // Load initially
            setInterval(fetchEarthquakeData, 120000); // Refresh every 2 minutes

            // Handle User Report Submission
            document.getElementById("report-submit").addEventListener("click", () => {
                const reportText = document.getElementById("user-report").value.trim();
                if (!reportText) {
                    alert("Please enter a report before submitting.");
                    return;
                }

                const reportList = document.getElementById("report-list");
                const newReport = document.createElement("p");
                newReport.textContent = reportText;
                reportList.appendChild(newReport);

                document.getElementById("user-report").value = ""; // Clear input after submitting
            });
        });
    </script>

</body>
</html>
